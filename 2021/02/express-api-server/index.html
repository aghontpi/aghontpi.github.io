<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><meta name=author content=Bluepie><meta name=description content="Public Journal of aghontpi"><meta name=keywords content="aghontpi bluepie Journal"><link rel=prev href=//bluepie.in/2021/01/preconfigured-binary-using-docker/><link rel=next href=//bluepie.in/2021/03/firebase-realtimedatabase/><link rel=canonical href=//bluepie.in/2021/02/express-api-server/><link rel=apple-touch-icon sizes=180x180 href=//bluepie.in/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//bluepie.in/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//bluepie.in/favicon-16x16.png><link rel=manifest href=//bluepie.in/site.webmanifest><link rel=mask-icon href=//bluepie.in/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><title>Express Api Server | Bluepie&#39;s Journal</title><meta name=title content="Express Api Server | Bluepie's Journal"><link rel=stylesheet href=//bluepie.in/font/iconfont.css><link rel=stylesheet href=//bluepie.in/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"\/\/bluepie.in\/"},"articleSection":"posts","name":"Express Api Server","headline":"Express Api Server","description":"After a hectic past two months, hope I get some free time in the upcomming months.\nWhat is this? This is a backend, written for one of my projects. This was originally developed to be a private repository, I made it public this month. And this was my first time using typescript 100 percent for backend, my experience with it is pretty cool.\nStack  express server mongodb nginx pm manager  Framework  model view controller  Folder structure    Name Description     src Source files of the server   src\/public Static files to be used on client side   src\/models Storing and retrieving datails from different schema, not using mongoose models   src\/controllers Controllers define functions that respond to various http requests   src\/server.","inLanguage":"en-us","author":"Bluepie","creator":"Bluepie","publisher":"Bluepie","accountablePerson":"Bluepie","copyrightHolder":"Bluepie","copyrightYear":"2021","datePublished":"2021-02-21 10:54:20 \x2b0000 UTC","dateModified":"2021-02-21 10:54:20 \x2b0000 UTC","url":"\/\/bluepie.in\/2021\/02\/express-api-server\/","wordCount":"385","keywords":["Bluepie\x27s Journal"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class="menu navbar-right"><a class=menu-item href=//bluepie.in/posts/>My Journal</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=//bluepie.in/posts/>My Journal</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-135013873-2','auto');ga('send','pageview');}</script><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Express Api Server</h1><div class=post-meta>Written by <a itemprop=name href=//bluepie.in/ rel=author>Bluepie</a> with ♥
<span class=post-time>on <time datetime=2021-02-21 itemprop=datePublished>February 21, 2021</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=//bluepie.in/categories/tech/>Tech</a>
<a href=//bluepie.in/categories/express/>express</a>
<a href=//bluepie.in/categories/nginx/>nginx</a>
<a href=//bluepie.in/categories/node/>node</a>
<a href=//bluepie.in/categories/backend/>backend</a></span></div></header><div class=post-content><img src=//bluepie.in/images/posts/express-api-server/express-backend.png class=featured_image><p>After a hectic past two months, hope I get some free time in the upcomming months.</p><h2 id=what-is-this>What is this?</h2><p>This is a backend, written for one of my projects. <em>This was originally developed to be a private repository, I made it public this month.</em> And this was my first time using typescript 100 percent for backend, my experience with it is pretty cool.</p><h2 id=stack>Stack</h2><ul><li>express server</li><li>mongodb</li><li>nginx</li><li>pm manager</li></ul><h2 id=framework>Framework</h2><ul><li>model</li><li>view</li><li>controller</li></ul><h3 id=folder-structure>Folder structure</h3><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><strong>src</strong></td><td>Source files of the server</td></tr><tr><td><strong>src/public</strong></td><td>Static files to be used on client side</td></tr><tr><td><strong>src/models</strong></td><td>Storing and retrieving datails from different schema, not using mongoose models</td></tr><tr><td><strong>src/controllers</strong></td><td>Controllers define functions that respond to various http requests</td></tr><tr><td><strong>src</strong>/server.ts</td><td>Entry point for the app</td></tr><tr><td><strong>src/util/</strong></td><td>helpers - logging, cache, ratelimit, database</td></tr><tr><td><strong>test</strong></td><td>Test cases to perform before taking a new build, is also used in combination with github actions before merging the code to master branch</td></tr><tr><td><strong>views</strong></td><td>Template files for rendering dynamic content to client side, since this is a api server, there is not much there in this folder.</td></tr><tr><td><strong>.env.example</strong></td><td>repos.</td></tr><tr><td><strong>.github</strong></td><td>CI - github actions - run test cases on pull request and report if it is safe to merge.</td></tr><tr><td><strong>cache</strong></td><td>Cache folder for responses that do not need to connect to database all the time.</td></tr></tbody></table><h3 id=explore-the-code-in-github>Explore the code in github</h3><p>Repository Link:</p><p><a href=https://github.com/aghontpi/watchlist-backend rel="nofollow noreferrer" target=_blank>https://github.com/aghontpi/watchlist-backend</a></p><h3 id=misc>Misc</h3><h4 id=a-cool-library-that-i-found-useful-for-testing-api>A cool library that I found useful for testing api</h4><p><a href=https://www.npmjs.com/package/supertest rel="nofollow noreferrer" target=_blank>supertest</a></p><p>see the code examples below, <a href=https://github.com/aghontpi/watchlist-backend/blob/104b3b1b53850c626f557a1936a68ce5bd0aa121/test/api.test.ts rel="nofollow noreferrer" target=_blank>link to source file</a></p><pre><code class=language-ts># testing routing redirect
describe('GET /asdfd/askf', () =&gt; {
  it('should return redirect', (done) =&gt; {
    request(app).get('/random').expect(302, done);
  });
});

# testing api endpoint
describe('GET /top', () =&gt; {
  it('should return type json with 200 OK', (done) =&gt; {
    request(app).get('/top').expect('Content-Type', /json/).expect(200, done);
  });
});

# testing rate limiting
describe('GET /top', () =&gt; {
  const req = request.agent(app);
  it('shoult not be ratelimited', (done) =&gt; {
    req.get('/top').expect(200, done);
  });
  it('should not be ratelimited', (done) =&gt; {
    req.get('/top').expect(200, done);
  });
  it('should not be ratelimited', (done) =&gt; {
    req.get('/top').expect(200, done);
  });
  it('should not be ratelimited', (done) =&gt; {
    req.get('/top').expect(200, done);
  });
  it('should &quot;be ratelimited&quot;', (done) =&gt; {
    req.get('/top').expect(429, done);
  });
});
</code></pre><h4 id=merging-pull-requests-automatically-run-tests-on-bug-fixes-and-new-features>Merging pull requests, automatically run tests on bug fixes and new features.</h4><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/express-api-server/pull-request-merge-after-build-success.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><h4 id=nginx-config-used-for-deploying>Nginx config used for deploying</h4><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/express-api-server/nginx-config-for-express-server.png alt="nginx config" class=lazyload><figcaption class=image-caption>nginx config</figcaption></figure></p><h4 id=pm2-managing-the-api>pm2 managing the api</h4><p><figure><img src=//bluepie.in/images/ring.svg data-sizes=auto data-src=//bluepie.in/images/posts/express-api-server/running-the-server-in-production.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><h2 id=end>End</h2><p>Hope this motivates my futureself in someway, keep learning and reach milestones constantly.</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Bluepie</span></p><p class=copyright-item><span>Link:</span>
<a href=//bluepie.in/2021/02/express-api-server/>//bluepie.in/2021/02/express-api-server/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=//bluepie.in/>home</a></span></section></div><div class=post-nav><a href=//bluepie.in/2021/01/preconfigured-binary-using-docker/ class=prev rel=prev title="Preconfigured Binary and Installer script through Docker"><i class="iconfont icon-left"></i>&nbsp;Preconfigured Binary and Installer script through Docker</a>
<a href=//bluepie.in/2021/03/firebase-realtimedatabase/ class=next rel=next title="Firebase-RealtimeDatabase &amp; Self-assesment">Firebase-RealtimeDatabase &amp; Self-assesment&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"gopinath001-github-io-blog"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2021</span>
<span class=with-love>|</span>
<span class=author itemprop=copyrightHolder><a href=//bluepie.in/>Bluepie</a></span></div></footer><link href=//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css rel=stylesheet><script src=//bluepie.in/js/vendor_gallery.min.js async></script></div></body></html>