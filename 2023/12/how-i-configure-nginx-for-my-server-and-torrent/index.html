<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><meta name=author content=Bluepie><meta name=description content="Public Journal of aghontpi"><meta name=keywords content="aghontpi bluepie Journal"><link rel=prev href=//bluepie.in/2023/11/self-hosted-netflix-replacer/><link rel=next href=//bluepie.in/2024/01/creating-and-publishing-chrome-extension-in-chrome-store/><link rel=canonical href=//bluepie.in/2023/12/how-i-configure-nginx-for-my-server-and-torrent/><link rel=apple-touch-icon sizes=180x180 href=//bluepie.in/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//bluepie.in/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//bluepie.in/favicon-16x16.png><link rel=manifest href=//bluepie.in/site.webmanifest><link rel=mask-icon href=//bluepie.in/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><title>How I Set Up Nginx and SSL for My Media Server and Torrent | Bluepie&#39;s Journal</title><meta name=title content="How I Set Up Nginx and SSL for My Media Server and Torrent | Bluepie's Journal"><link rel=stylesheet href=//bluepie.in/font/iconfont.css><link rel=stylesheet href=//bluepie.in/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"\/\/bluepie.in\/"},"articleSection":"posts","name":"How I Set Up Nginx and SSL for My Media Server and Torrent","headline":"How I Set Up Nginx and SSL for My Media Server and Torrent","description":"Context This post is a nginx configurations of my How I replaced Netflix and started using my media server for over 2 years now\n config of jellyfin  We already run jellyfin inside podman and expose the service on port 8096, so we use nginx to handle requests to domain \x26lsquo;media.bluepie.in\x26rsquo;, which connects to jellyfin podman instance.\nI point my domain (through domain provider) to the ip address of the server im running my jellyfin instance, then use nginx to serve the requests, the nginx configs are located inside config folders and are included in main file.","inLanguage":"en-us","author":"Bluepie","creator":"Bluepie","publisher":"Bluepie","accountablePerson":"Bluepie","copyrightHolder":"Bluepie","copyrightYear":"2023","datePublished":"2023-12-07 20:49:16 \x2b0000 UTC","dateModified":"2023-12-07 20:49:16 \x2b0000 UTC","url":"\/\/bluepie.in\/2023\/12\/how-i-configure-nginx-for-my-server-and-torrent\/","wordCount":"1246","keywords":["Bluepie\x27s Journal"]}</script><script type=text/javascript>(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window,document,"clarity","script","9oioq6tja4");</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class="menu navbar-right"><a class=menu-item href=//bluepie.in/posts/>Journal entries</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="extra extra-moon"></i></a>&nbsp;<a href=//bluepie.in/>Bluepie&#39;s Journal</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=//bluepie.in/posts/>Journal entries</a>
<a class=menu-item href=//bluepie.in/categories/>Categories</a></div></div></nav><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-135013873-2','auto');ga('send','pageview');}</script><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">How I Set Up Nginx and SSL for My Media Server and Torrent</h1><div class=post-meta>Written by <a itemprop=name href=//bluepie.in/ rel=author>Bluepie</a> with ♥
<span class=post-time>on <time datetime=2023-12-07 itemprop=datePublished>December 7, 2023</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=//bluepie.in/categories/tech/>Tech</a>
<a href=//bluepie.in/categories/server/>Server</a>
<a href=//bluepie.in/categories/nginx/>nginx</a>
<a href=//bluepie.in/categories/media-server/>Media Server</a>
<a href=//bluepie.in/categories/jellyfin/>Jellyfin</a>
<a href=//bluepie.in/categories/qbittorrent/>Qbittorrent</a>
<a href=//bluepie.in/categories/self-hosted/>Self Hosted</a></span></div></header><div class=post-content><img src=//bluepie.in/images/posts/how-i-configure-nginx-ssl-for-my-media-and-torrent/post-nginx-config-for-media-and-torrent.png class=featured_image><h2 id=context>Context</h2><p>This post is a nginx configurations of my <a href=https://bluepie.in/2023/11/self-hosted-netflix-replacer/ rel="nofollow noreferrer" target=_blank>How I replaced Netflix and started using my media server for over 2 years now</a></p><ul><li>config of jellyfin</li></ul><p>We already run jellyfin inside podman and expose the service on port 8096, so we use nginx to handle requests to domain &lsquo;media.bluepie.in&rsquo;, which connects to jellyfin podman instance.</p><p>I point my domain (through domain provider) to the ip address of the server im running my jellyfin instance, then use nginx to serve the requests, the nginx configs are located inside config folders and are included in main file.</p><p><strong>Setting Up Nginx (Reminder for me, others ignore)</strong></p><ul><li>Install Nginx.</li><li>Then, make a config file in the conf.d folder. I use one config file for each domain and add it to the main Nginx config with /etc/nginx/conf.d/*.conf</li><li>Check Nginx config: <code>nginx -t</code></li><li>Restart Nginx: <code>sudo service nginx restart</code></li><li>Reload Nginx: <code>sudo service nginx reload</code></li></ul><p><strong>Config file for media server</strong></p><pre><code class=language-conf>  server {
	server_name media.bluepie.in;

	location / {
      proxy_pass http://127.0.0.1:8096;
      proxy_pass_request_headers on;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header X-Forwarded-Protocol $scheme;
      proxy_set_header X-Forwarded-Host $http_host;

      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $http_connection;
      proxy_buffering on;
	    proxy_redirect / / ;
	    proxy_cookie_path / /;
	}

</code></pre><ul><li>config of torrent</li></ul><p>Instead of maintaining a separate domain for running qBittorrent, I utilize the main domain but with the &lsquo;/torrent/&rsquo; prefix. To enhance security and prevent others from accessing it, I implement two layers of protection: HTTP basic authentication. For this purpose, a new .htpasswd file is created and linked with Nginx for handling HTTP basic login before accessing qBittorrent. After the initial login to qBittorrent, the username and password are configured. Subsequently, during subsequent logins, users will be prompted for HTTP basic authentication first and then for qBittorrent authentication.</p><p><strong>Creating a .htpasswd File for Authentication:</strong></p><p>(self note: The auth_basic and auth_basic_user_file directives are built-in and don&rsquo;t require any extra modules)</p><ul><li><p>Creation:</p><pre><code class=language-bash>htpasswd -c /etc/nginx/.htpasswd &lt;username&gt;
</code></pre></li><li><p>Subsequently, specify its usage in Nginx:</p><pre><code class=language-conf>auth_basic &quot;Restricted Access&quot;;
auth_basic_user_file /etc/nginx/.htpasswd;
</code></pre></li></ul><p><strong>Config to be added to main nginx config</strong></p><pre><code class=language-conf>        location /torrent/ {
            proxy_pass http://127.0.0.1:8181/;
            proxy_set_header Host $host;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection upgrade;
            proxy_set_header Accept-Encoding gzip;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Port $server_port;
            auth_basic &quot;restricted space&quot;;
            auth_basic_user_file /etc/nginx/.htpasswd;
        }

</code></pre><p>I automate SSL certificate renewals across my devices with Certbot, ensuring secure, uninterrupted service without manual oversight. The heart of this automation is a daily cron job configured to run Certbot&rsquo;s renewal command, specifically opting for the &ndash;preferred-chain &ldquo;ISRG Root X1&rdquo; to ensure broad compatibility (particularly for setting up custom DNS servers on Android devices that are operating on version 10 or higher). Here&rsquo;s the crux of the setup:</p><pre><code class=language-sh>SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin

10 0 * * * /usr/bin/certbot renew --preferred-chain &quot;ISRG Root X1&quot; &gt;&gt; /home/&lt;user&gt;/cronlog.log 2&gt;&amp;1
# The schedule 10 0 * * * means the task will run at 12:10 AM every day server time.
</code></pre><p>This approach leverages the reliability of cron for scheduling and Certbot for execution, automating the renewal process and logging outcomes for easy monitoring. It&rsquo;s a streamlined, efficient method.</p><h3 id=an-insight-into-dns-renewal-challenges-unrelated-to-jellyfin-or-qbittorrent>An Insight into DNS Renewal Challenges (Unrelated to Jellyfin or qBittorrent)</h3><p>Every time I want to renews the whildcard DNS domain (i.e) *.dns.bluepie.in, I start with logging in and checking the cronlog.log in my logs Directory. This log helps me keep track of the automated renewals for all services running in that server.</p><p>This setup works well for most of my domains, automatically renewing their certificates. However, there&rsquo;s a catch with the wildcard domain *.dns.bluepie.in which requires a manual renewal process every two months. After renewing, I manually move the private key and pem files do dns service so that it can read and update the certificates.</p><p>The manual part involves adding a DNS TXT record for _acme-challenge.dns.bluepie.in. and waiting for it to be verified. This process, although straightforward, is a bit of a hassle because it can&rsquo;t be automated with my current setup. After updating the DNS record, I always double-check to make sure it&rsquo;s correctly deployed using the Google Admin Toolbox: <a href=https://toolbox.googleapps.com/apps/dig/#TXT/_acme-challenge.dns.bluepie.in rel="nofollow noreferrer" target=_blank>https://toolbox.googleapps.com/apps/dig/#TXT/_acme-challenge.dns.bluepie.in</a>. This tool confirms the record is live, which is crucial before proceeding with the certification.</p><p>The Google Admin Toolbox, specifically the &ldquo;Dig&rdquo; tool, is a web-based version of the Unix dig command, which I often use for DNS verification. This tool is part of a suite designed to troubleshoot Google Workspace services and is particularly handy for checking DNS record propagation, such as the TXT records required for SSL certificate validation. I use this tool to confirm that the record is correctly propagated across the DNS system. This step is crucial because the validation of SSL certificates by Let&rsquo;s Encrypt (or any other certificate authority that supports DNS-01 challenge). For more detailed functionalities and tools, you can explore the toolbox directly at <a href=https://toolbox.googleapps.com/ rel="nofollow noreferrer" target=_blank>toolbox.googleapps.com​</a>.</p><p>I&rsquo;ve been thinking about solving this issue by integrating with the GoDaddy API for DNS wildcard renewal. Doing this would remove the need for manual intervention every two months, making the process smoother and fully automated. It&rsquo;s definitely something I plan to work on in the future to streamline my server management tasks.</p><hr><h2 id=personal-update>Personal Update</h2><p><em>This section typically opens each of my posts, a tradition spanning many years. However, I&rsquo;ve decided it might be better placed at the end moving forward.</em></p><p>I&rsquo;ve begun to engage heavily with LeetCode this year, a detail I haven&rsquo;t shared in my posts. So, in case future me forgets, I&rsquo;m jotting it down here for remembrance. Remember <a href=https://adventofcode.com/ rel="nofollow noreferrer" target=_blank>AOC</a>, which I previously tackled in 2020 and maintained a GitHub repo <a href=https://bluepie.in/2020/12/adventofcode-2020/ rel="nofollow noreferrer" target=_blank>here</a>? I&rsquo;ve opted to take it on this year as well. Yes, even though my plate is overflowing, I&rsquo;ve decided to add this to my queue&hellip; I know, :facepalm:.</p><p>I&rsquo;ve leased a new place in Chennai (Mugalivakkam), roughly 6 kilometers from my current office. It&rsquo;s a 2BHK flat with parking facilities. I moved in, stating that it would be a family residence, with plans for my parents to join me. This decision came after a series of abrupt changes. Initially, I had a different plan in mind, but it&rsquo;s funny how things evolve up to the last moment. My friend from the police force, with whom I&rsquo;ve lived since after COVID and who recently got posted in Chennai after passing his exams, is a close friend. So, despite only needing to be in the Chennai office two days every two weeks (totalling four days a month) and despite the office policy changing around August/September to require my presence two days every week, I opted for a permanent stay over the convenience of crashing at a friend&rsquo;s place. My decision was influenced by several factors:</p><ul><li>My close friend, who I&rsquo;ve known for eight years (time really flies), got a posting in Erode and plans to move out in December 2024. He had his transfer announced just before Diwali in 2023.</li><li>Parents take care of me, homemade food, household chores, them being atpeace without worring seeing me everyday.</li><li>The home-like setup for productivity and peace of mind.</li></ul><p>I&rsquo;m writing this update after December, so for me, December is already in the past. I&rsquo;ve been sick and bedridden over Christmas, alone since my friends and family were in their hometowns, including my parents. Despite my mother&rsquo;s insistence on coming over as soon as possible because of my neglect towards self-care and healthy eating, I plan to bring them here in January after Pongal 2024. This is another reason I chose an individual house over sharing a space with friends, opting for a PG, or having a flatmate.</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Bluepie</span></p><p class=copyright-item><span>Link:</span>
<a href=//bluepie.in/2023/12/how-i-configure-nginx-for-my-server-and-torrent/>//bluepie.in/2023/12/how-i-configure-nginx-for-my-server-and-torrent/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=//bluepie.in/>home</a></span></section></div><div class=post-nav><a href=//bluepie.in/2023/11/self-hosted-netflix-replacer/ class=prev rel=prev title="How I Replaced Netflix and Have Been Using My Media Server for Over 2 Years"><i class="iconfont icon-left"></i>&nbsp;How I Replaced Netflix and Have Been Using My Media Server for Over 2 Years</a>
<a href=//bluepie.in/2024/01/creating-and-publishing-chrome-extension-in-chrome-store/ class=next rel=next title="Creating and Publishing Chrome Extension in Chrome Store">Creating and Publishing Chrome Extension in Chrome Store&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"gopinath001-github-io-blog"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2025</span>
<span class=with-love>|</span>
<span class=author itemprop=copyrightHolder><a href=//bluepie.in/>Bluepie</a></span></div></footer><script src=//bluepie.in/js/vendor_no_gallery.min.js async></script></div></body></html>